<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BookVerse</title>
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="manifest" href="images/site.webmanifest">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
  <div class="container py-5">
    <h1 class="text-center mb-4">ðŸ“š BookVerse</h1>

    <form id="bookForm" class="row g-3 mb-4">
      <div class="col-md-5">
        <label for="title" class="form-label">Book Title:</label>
        <input type="text" class="form-control" id="title" placeholder="Book Title" name="title" required />
      </div>
      <div class="col-md-5">
        <label for="author" class="form-label">Book Author:</label>
        <input type="text" class="form-control" id="author" placeholder="Author Name" name="author" required />
      </div>
      <div class="col-md-2 d-grid w-10 h-50 align-self-end">
        <button type="submit" class="btn btn-primary">Add Book</button>
      </div>
    </form>

    <div class="card">
      <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">Book List</h5>
      </div>
      <ul class="list-group list-group-flush" id="bookList">
        <!-- Books will be inserted here -->
      </ul>
    </div>
  </div>

  <script>
    const bookForm = document.getElementById('bookForm');
    const bookList = document.getElementById('bookList');

    async function fetchBooks() {
      const res = await fetch('/api/books'); //fetching from backend service with the name "backend"
      const books = await res.json();
      bookList.innerHTML = '';
      books.forEach(book => {
        const li = document.createElement('li');
        const delButton = document.createElement("button");
        delButton.className = 'btn btn-danger btn-sm';
        delButton.innerText = "Delete";
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<strong>${book.title}</strong> <span class="text-muted">by ${book.author}</span>`;
        li.append(delButton);
        bookList.appendChild(li);
        delButton.addEventListener('click', async () => {
          await fetch(`/api/books/${book._id}`, {
            method: 'DELETE',
          });
          fetchBooks();
        });
      });
    }

    bookForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      const author = document.getElementById('author').value.trim();
      if (title && author) {
        await fetch('/api/books', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, author }),
        });
        bookForm.reset();
        fetchBooks();
      }
    });

    fetchBooks();
  </script>
</body>

</html>